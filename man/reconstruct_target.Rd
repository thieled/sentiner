% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/04_masked_translate.R
\name{reconstruct_target}
\alias{reconstruct_target}
\title{Reconstruct Exact Named-Entity Wording From Source Text}
\usage{
reconstruct_target(
  dt,
  text_col = "text",
  entity_col = "target",
  out_col = "exact_target",
  case_insensitive = TRUE,
  max_prefix = 3L,
  max_suffix = 3L
)
}
\arguments{
\item{dt}{A \code{data.table} containing the source text and entity columns.}

\item{text_col}{Character scalar. Name of the column containing the source text.}

\item{entity_col}{Character scalar. Name of the column containing the entity string to reconstruct.}

\item{out_col}{Character scalar. Name of the output column to create with the reconstructed entity.}

\item{case_insensitive}{Logical scalar. If \code{TRUE}, matching ignores case.}

\item{max_prefix}{Integer scalar >= 0. Maximum number of prefix characters allowed before the
entity core in extended matching mode.}

\item{max_suffix}{Integer scalar >= 0. Maximum number of suffix characters allowed after the
entity core in extended matching mode.}
}
\value{
A copy of \code{dt} with an added column \code{out_col}. If no match is found or
inputs are empty/NA, \code{out_col} is \code{NA_character_}.
}
\description{
Attempts to restore the exact surface form (original casing/punctuation/handle-ish affixes)
of a named entity from a source text. This is useful when the entity string in
\code{entity_col} has no exact match in \code{text_col} due to casing differences,
missing punctuation, tokenization artifacts, or short prefixes/suffixes (e.g., \code{@},
underscores, or brief alphanumeric attachments).
}
\details{
The function searches each text for regex matches of the entity tokens with
Unicode-aware boundaries. For multi-token entities, it allows flexible separators
(whitespace and punctuation). Optionally, it also allows a short alphanumeric/handle-like
prefix and/or suffix around the entity (controlled by \code{max_prefix} and \code{max_suffix}).

If multiple matches are found, the most frequent match is selected; ties are broken by
choosing the earliest occurrence in the text.
}
