% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/04_masked_translate.R
\name{masked_ent_translate}
\alias{masked_ent_translate}
\title{Translate Text with Masked Named Entities}
\usage{
masked_ent_translate(
  data,
  text_col = "text_clean",
  entity_col = "entity_name",
  id_col = "ent_id",
  conda_env_name = "r-sentiner",
  targ_lang = "en",
  n_retries = 3L,
  seed = 42L,
  beam_size = 1L,
  deterministic = TRUE,
  ...
)
}
\arguments{
\item{data}{A data.frame or data.table containing the texts and named entities.}

\item{text_col}{Character, name of the text column to translate. Default = \code{"text_clean"}.}

\item{entity_col}{Character, name of the column with target entity names.
Default = \code{"entity_name"}.}

\item{id_col}{Character, name of the identifier column for unique observations.
Default = \code{"ent_id"}.}

\item{conda_env_name}{Character, name of the Conda environment to use for
Python back-end. Default = \code{"r-sentiner"}.}

\item{targ_lang}{Character, target language code for translation.
Default = \code{"en"}.}

\item{n_retries}{Integer, maximum number of retries if placeholders are not
preserved in translation. Default = \code{3L}.}

\item{seed}{Integer, random seed for reproducibility. Default = \code{42L}.}

\item{beam_size}{Integer, beam size for translation decoding. Default = \code{1L}.}

\item{deterministic}{Logical, whether to use deterministic translation
settings. Default = \code{TRUE}.}

\item{...}{Additional arguments passed to either
\code{initialize_sentiner()} or \code{easieRnmt::translate()}. Unknown
arguments are ignored with a warning.}
}
\value{
A data.table with translations and metadata. Columns include:
\itemize{
\item \code{id}: Identifier for each text.
\item \code{translation}: Final translation with entities unmasked.
\item \code{translation_masked}: Translation with placeholders still present.
\item \code{lang}, \code{lang_prob}: Detected language and probability.
\item \code{tl_error}: Any translation errors or retry information.
\item \code{tl_datetime}, \code{tl_model}: Translation metadata.
\item Additional columns preserved from the input data.
}
}
\description{
Translates texts while masking named entities to ensure placeholders
are preserved during translation. The function integrates with the
\pkg{easieRnmt} back-end and automatically retries translations if
entity placeholders are lost. It installs and initializes the Python
environment if necessary, masks entities, performs translation, repairs
placeholders, retries failed cases, and finally unmasks entities.
}
\details{
The function follows a multi-step process:
\enumerate{
\item Initialize Python back-end with \code{initialize_sentiner()}.
\item Install \code{EasyNMT} and \code{fasttext} if missing.
\item Mask named entities in the text with placeholders.
\item Translate masked texts using \pkg{easieRnmt}.
\item Repair placeholders to ensure consistent formatting.
\item Retry translations if placeholders are dropped.
\item Unmask entities by replacing placeholders with the original names.
}

Placeholders are preserved in the form \code{"[:XXNEXX:]"} during translation.
If they are lost, the function automatically retries with modified parameters
(incrementing seed and beam size, and setting deterministic = FALSE if retries
exceed two attempts).
}
\seealso{
\code{\link{initialize_sentiner}}, \code{\link[easieRnmt]{translate}}
}
