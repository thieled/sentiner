% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03_fuzzy_matching.R
\name{fuzzy_match_df}
\alias{fuzzy_match_df}
\title{Fuzzy-match strings against a reference table (optionally: within groups)}
\usage{
fuzzy_match_df(
  input,
  target,
  input_col,
  target_col,
  input_id_col = NULL,
  target_id_col = NULL,
  group_vars = NULL,
  fuzzy = TRUE,
  stopwords = NULL,
  method = "jw",
  p = 0.2,
  threshold = 0.2,
  normalize = c("none", "length"),
  tolower = TRUE,
  verbose = TRUE,
  best_by_input_id = FALSE,
  best_by_target_id = FALSE
)
}
\arguments{
\item{input}{A data frame containing the messy text to be matched.}

\item{target}{A data frame containing the harmonized labels.}

\item{input_col}{A string giving the column name in \code{input} with messy text values.}

\item{target_col}{A string giving the column name in \code{target} with harmonized labels.}

\item{input_id_col}{A string naming an optional ID column in \code{input} to pass through.
Default \code{NULL}.}

\item{target_id_col}{A string naming an optional ID column in \code{target} to return for matches.
Default \code{NULL}.}

\item{group_vars}{A character vector of column names present in both \code{input} and \code{target}
that define matching groups. Matching is only performed within groups.
Default \code{NULL}.}

\item{fuzzy}{Logical. Whether to perform fuzzy matching for non-exact rows.
Default \code{TRUE}.}

\item{stopwords}{A character vector of tokens to remove before distance calculation.
Default \code{NULL}.}

\item{method}{A string giving the string distance method passed to \code{stringdist}.
Default \code{"jw"}.}

\item{p}{A numeric tuning parameter for the distance method (e.g., Jaroâ€“Winkler).
Default \code{0.2}.}

\item{threshold}{A numeric distance cutoff in range 0-1. Matches with distance greater
than this are considered poor and set to \code{NA}. Default \code{0.20}.}

\item{normalize}{Either \code{"none"} or \code{"length"}. Whether to normalize distances.
Default \code{"none"}.}

\item{tolower}{Logical. If \code{TRUE}, text is converted to lowercase before matching.
Default \code{TRUE}.}

\item{verbose}{Logical. If \code{TRUE}, prints a brief summary of matches. Default \code{TRUE}.}

\item{best_by_input_id}{Logical. If \code{TRUE} and \code{input_id_col} is provided, deduplicates
the output by input ID, keeping only the row with the lowest distance (exact matches
preferred, \code{NA} treated as worst). Default \code{FALSE}.}

\item{best_by_target_id}{Logical. If \code{TRUE} and \code{target_id_col} is provided, flags
duplicate matches by target ID. For each target ID, the match with the lowest distance
is kept as-is, and all others are flagged with \code{poor_match = TRUE}. No rows are dropped.
Default \code{FALSE}.}
}
\value{
A data frame with the following columns:
\itemize{
\item \code{group_vars} (if supplied),
\item \code{input_id} (if supplied),
\item \code{input} (original values from input),
\item \code{matched_target} (best match from target),
\item \code{target_id} (if supplied),
\item \code{exact_match} (logical, whether exact match),
\item \code{distance} (string distance to match),
\item \code{poor_match} (logical, TRUE if flagged as poor or duplicate).
}
}
\description{
Matches a (messy) text column in \code{input} to a (cleaned) label column in \code{target},
optionally returning IDs from both sides. If \code{group_vars} are specified, matching
is constrained within group columns shared by both data frames (e.g., country).
Exact matches are attempted first, followed by optional fuzzy matching.
Poor matches, where the similarit distance exeeds \code{threshold} are flagged and have
their label/target ID set to \code{NA}. Additional options allow deduplication
by input (keeping \code{best_by_input_id}) or by target IDs (flagging the worse duplicate
match as poor, \code{best_by_target_id}). The function is useful to match IDs
of known entities to an input data.frame that lacks these IDs.
}
