% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/03_fuzzy_matching.R
\name{fuzzy_filter}
\alias{fuzzy_filter}
\title{Filter and merge fuzzy matches with NER output}
\usage{
fuzzy_filter(
  input,
  target,
  input_col = "entity_name",
  input_id_col = "id",
  target_col,
  target_id_col = NULL,
  group_vars = NULL,
  fuzzy = TRUE,
  stopwords = NULL,
  method = "jw",
  p = 0.2,
  threshold = 0.02,
  normalize = "none",
  tolower = TRUE,
  verbose = TRUE,
  best_by_input_id = TRUE,
  best_by_target_id = FALSE,
  keep_na = FALSE
)
}
\arguments{
\item{input}{A data.frame or data.table containing NER output, typically from
\code{\link[=gliner_extract]{gliner_extract()}}. Must include a column matching \code{input_id_col}
(default \code{"id"}).}

\item{target}{A data frame containing the harmonized labels.}

\item{input_col}{A string giving the column name in \code{input} with messy text values.}

\item{input_id_col}{A string naming an optional ID column in \code{input} to pass through.
Default \code{NULL}.}

\item{target_col}{A string giving the column name in \code{target} with harmonized labels.}

\item{target_id_col}{A string naming an optional ID column in \code{target} to return for matches.
Default \code{NULL}.}

\item{group_vars}{A character vector of column names present in both \code{input} and \code{target}
that define matching groups. Matching is only performed within groups.
Default \code{NULL}.}

\item{fuzzy}{Logical. Whether to perform fuzzy matching for non-exact rows.
Default \code{TRUE}.}

\item{stopwords}{A character vector of tokens to remove before distance calculation.
Default \code{NULL}.}

\item{method}{A string giving the string distance method passed to \code{stringdist}.
Default \code{"jw"}.}

\item{p}{A numeric tuning parameter for the distance method (e.g., Jaro–Winkler).
Default \code{0.2}.}

\item{threshold}{A numeric distance cutoff in range 0-1. Matches with distance greater
than this are considered poor and set to \code{NA}. Default \code{0.20}.}

\item{normalize}{Either \code{"none"} or \code{"length"}. Whether to normalize distances.
Default \code{"none"}.}

\item{tolower}{Logical. If \code{TRUE}, text is converted to lowercase before matching.
Default \code{TRUE}.}

\item{verbose}{Logical. If \code{TRUE}, prints a brief summary of matches. Default \code{TRUE}.}

\item{best_by_input_id}{Logical. If \code{TRUE} and \code{input_id_col} is provided, deduplicates
the output by input ID, keeping only the row with the lowest distance (exact matches
preferred, \code{NA} treated as worst). Default \code{FALSE}.}

\item{best_by_target_id}{Logical. If \code{TRUE} and \code{target_id_col} is provided, flags
duplicate matches by target ID. For each target ID, the match with the lowest distance
is kept as-is, and all others are flagged with \code{poor_match = TRUE}. No rows are dropped.
Default \code{FALSE}.}

\item{keep_na}{Logical. Keep rows where \code{fuzzy_match_df()} returned \code{NA}
in column \code{input}? Default FALSE.}
}
\value{
A data.table with columns:
\itemize{
\item \verb{<input_id_col>} – entity ID from \code{input} (default \code{id}).
\item \code{matched_target} – best-matched label from \code{target}.
\item \verb{<target_id_col>} – preserved if supplied.
\item \code{match_distance} – string distance to the matched label.
\item all columns from \code{input}.
}
}
\description{
Combines Named Entity Recognition (NER) results with fuzzy matching against a
target dictionary. Internally calls \code{\link[=fuzzy_match_df]{fuzzy_match_df()}} to perform exact and/or
fuzzy matching, then merges matches back into the NER results. If a
\code{target_id_col} is supplied, the output preserves this exact column name.
}
\seealso{
\code{\link[=gliner_extract]{gliner_extract()}}, \code{\link[=fuzzy_match_df]{fuzzy_match_df()}}
}
